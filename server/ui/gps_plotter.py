import sys
import io
import folium # pip install folium
from PyQt5.QtWebEngineWidgets import QWebEngineView
from PyQt5 import uic
import requests
from PyQt5.QtCore import *
from PyQt5.QtGui import *
from PyQt5.QtWidgets import *
import attitude_indicator
import compass
import gst_widget
from PIL import Image


headers = {"X-API-Key": "281c928ea60d404ab7d30be698"}
metar = "\n\n".join(requests.get("https://api.checkwx.com/metar/lat/38.95/lon/-76.51", headers=headers).json()["data"])
#print(metar)


coords_1=[[28.65685,77.21899],[28.65699,77.21898],[28.65699,77.21898],
[28.65702,77.21875],[28.65702,77.21875],[28.6547,77.21902],[28.65308,77.21921],
[28.65286,77.21926],[28.65255,77.21938],[28.65227,77.21954],[28.65152,77.22005],
[28.64655,77.22346],[28.64643,77.22354],[28.64635,77.22357],[28.64623,77.2236],
[28.64616,77.22363],[28.64612,77.22364],[28.64557,77.22364],[28.64525,77.22365],
[28.64525,77.22365],[28.64517,77.22366],[28.64515,77.22367],[28.64512,77.22367],
[28.64504,77.22369],[28.64493,77.22371],[28.64483,77.22373],[28.64462,77.22377],
[28.6445,77.22381],[28.64444,77.22383],[28.64439,77.22387],[28.64434,77.2239],
[28.64429,77.22395],[28.64421,77.22403],[28.64417,77.22412],[28.64407,77.22429],
[28.64391,77.22465],[28.64353,77.22539],[28.64282,77.22678],[28.64282,77.22678],
[28.64285,77.2268],[28.64287,77.22683],[28.64289,77.22686],[28.64291,77.2269],
[28.64292,77.22694],[28.64292,77.22697],[28.64292,77.22701],[28.64292,77.22705],
[28.64292,77.22705],[28.64291,77.22711],[28.64288,77.22716],[28.64285,77.2272],
[28.64281,77.22724],[28.64276,77.22726],[28.64271,77.22728],[28.64266,77.22728],
[28.64261,77.22727],[28.64261,77.22727],[28.64257,77.22725],[28.64254,77.22723],
[28.64251,77.2272],[28.64249,77.22717],[28.64247,77.22713],[28.64245,77.22709],
[28.64244,77.22704],[28.64244,77.22699],[28.64245,77.22693],[28.64246,77.22689],
[28.64214,77.22665],[28.64169,77.22632],[28.64163,77.22627],[28.64095,77.22582],
[28.64009,77.22516],[28.63913,77.22445],[28.63799,77.22352],[28.63794,77.22349],
[28.63761,77.22327],[28.6375,77.2232],[28.63737,77.22311],[28.63727,77.22304],
[28.63706,77.22288],[28.63631,77.22233],[28.63528,77.2216],[28.63521,77.22154],
[28.63521,77.22154],[28.63518,77.22158],[28.63499,77.2218],[28.63471,77.22212],
[28.63442,77.22238],[28.63411,77.2226],[28.6339,77.22272],[28.63368,77.22282],
[28.63345,77.2229],[28.63313,77.22297],[28.63281,77.22299],[28.63249,77.22298],
[28.63217,77.22293],[28.63186,77.22283],[28.63141,77.22256],[28.63125,77.2224],
[28.63101,77.22227],[28.63082,77.22207],[28.63062,77.22185],[28.63046,77.22162],
[28.63029,77.22141],[28.63029,77.22141],[28.63026,77.22138],[28.63022,77.22136],
[28.63018,77.22135],[28.63014,77.22134],[28.6301,77.22134],[28.63006,77.22135],
[28.63004,77.22135],[28.63004,77.22135]]

coords_2=[[28.63382,77.22045],[28.63458,77.221],[28.63514,77.22142],
[28.63517,77.22146],[28.63519,77.22151],[28.63518,77.22158],[28.63518,77.22158],
[28.63499,77.2218],[28.63471,77.22212],[28.63442,77.22238],[28.63411,77.2226],
[28.6339,77.22272],[28.63368,77.22282],[28.63345,77.2229],[28.63313,77.22297],
[28.63281,77.22299],[28.63249,77.22298],[28.63217,77.22293],[28.63186,77.22283],
[28.63141,77.22256],[28.63141,77.22256],[28.63129,77.22258],[28.63121,77.22259],
[28.63113,77.22266],[28.63072,77.22335],[28.63063,77.22353],[28.63059,77.22359],
[28.63046,77.22381],[28.63043,77.22388],[28.62914,77.22615],[28.62914,77.22615],
[28.62922,77.22648],[28.62923,77.22651],[28.62924,77.22653],[28.62925,77.22655],
[28.62926,77.22657],[28.62935,77.22665],[28.62937,77.22667],[28.62938,77.22669],
[28.62939,77.22672],[28.62943,77.22682],[28.62943,77.22682],[28.62972,77.22701],
[28.63027,77.22744],[28.63436,77.23048],[28.63456,77.2306],[28.63482,77.23072],
[28.63511,77.23084],[28.63545,77.23091],[28.63581,77.23095],[28.63656,77.23101],
[28.63673,77.23102],[28.63824,77.23116],[28.63985,77.23134],[28.64039,77.23144],
[28.64039,77.23144],[28.64049,77.23147],[28.64038,77.23156],[28.64022,77.23153],
[28.64022,77.23153]]

coords_3=[[28.63216,77.21864],[28.63225,77.21858],[28.63237,77.21851],
[28.6325,77.21846],[28.63262,77.21843],[28.63279,77.21841],[28.63295,77.21843],
[28.63311,77.21846],[28.63326,77.21853],[28.63341,77.21862],[28.63341,77.21862],
[28.63394,77.21768],[28.6342,77.21722],[28.63425,77.21713],[28.6343,77.21704],
[28.6343,77.21704],[28.63432,77.21686],[28.63495,77.21581],[28.6357,77.21452],
[28.63745,77.21151],[28.63951,77.20794],[28.63956,77.20787],[28.63971,77.20763],
[28.64055,77.2061],[28.64096,77.20533],[28.64106,77.20519],[28.64121,77.20486],
[28.64132,77.20468],[28.64179,77.20418],[28.64222,77.20381],[28.64254,77.20346],
[28.64267,77.20333],[28.64277,77.2032],[28.64277,77.2032],[28.64281,77.20314],
[28.64285,77.20309],[28.64291,77.20306],[28.64297,77.20304],[28.64303,77.20303],
[28.64309,77.20304],[28.64315,77.20306],[28.6432,77.2031],[28.64324,77.20314],
[28.64327,77.2032],[28.64327,77.2032],[28.64341,77.20336],[28.64375,77.20351],
[28.64406,77.20367],[28.64495,77.20426],[28.6459,77.20495],[28.64612,77.2051],
[28.64612,77.2051],[28.64629,77.2051],[28.64639,77.20508],[28.64648,77.20506],
[28.64657,77.20497],[28.64659,77.20495],[28.64659,77.20495]]



class Window(QMainWindow):
	
	def __init__(self):
		super().__init__()
		uic.loadUi('design.ui', self)
		self.setWindowTitle("Flight Control")
		self.configure()
		
		
	def closeEvent(self, event):
		self.close()
		self.cam_feed.close()
		
	def configure(self):


		coordinates = [28.644800, 77.216721]
		
		m = folium.Map(
			tiles = 'OpenStreetMap',
			zoom_start = 13,
			location=coordinates
		)
		
		folium.TileLayer('OpenStreetMap').add_to(m)
		folium.TileLayer('Stamen Terrain').add_to(m)
		folium.TileLayer('Stamen Toner').add_to(m)
		folium.TileLayer('Stamen Water Color').add_to(m)
		folium.TileLayer('CartoDB positron').add_to(m)
		folium.TileLayer('CartoDB dark_matter').add_to(m)

		
		folium.LayerControl().add_to(m)


		line_1=folium.vector_layers.PolyLine(coords_1,popup='<b>Path of Vehicle_1</b>',tooltip='Vehicle_1',color='blue',weight=10).add_to(m)
		line_2=folium.vector_layers.PolyLine(coords_2,popup='<b>Path of Vehicle_2</b>',tooltip='Vehicle_2',color='red',weight=10).add_to(m)
		line_3=folium.vector_layers.PolyLine(coords_3,popup='<b>Path of Vehicle_3</b>',tooltip='Vehicle_3',color='green',weight=10).add_to(m)
		
		
		folium.Marker(location=[28.695800, 77.244721],popup='Default popup Marker1',tooltip='Click here to see Popup', icon=folium.Icon(color='red',icon='home')).add_to(m)
		folium.Marker(location=[28.645800, 77.214721],popup='<strong>Marker3</strong>',tooltip='<strong>Click here to see Popup</strong>').add_to(m)
		folium.Marker(location=[28.655800, 77.274721],popup='<h3 style="color:green;">Marker2</h3>',tooltip='<strong>Click here to see Popup</strong>').add_to(m)

		
		
		folium.Marker(location=[28.4211091,77.0267361], popup='Custom Marker 1', tooltip='Click here to see Popup', icon=folium.Icon(color='red',icon='plane', prefix="fa")).add_to(m)
		

		# save map data to data object
		data = io.BytesIO()
		m.save(data, close_file=False)

		webView = QWebEngineView()
		webView.setHtml(data.getvalue().decode())
		
		self.bottomLayout.addWidget(webView)
		
		meterLayout = QVBoxLayout()
		self.bottomLayout.addLayout(meterLayout)
		
		self.functionLayout.addWidget(compass.CompassWidget())
		meterLayout.addWidget(attitude_indicator.AttitudeIndicator())
		
		
		self.metar.setText(metar)
		



if __name__ == '__main__':
	app = QApplication([])
	window = Window()
	window.show()
	cam_feed = gst_widget.VideoWidget(flags=None)
	cam_feed.show()
	window.cam_feed = cam_feed
	sys.exit(app.exec_())
